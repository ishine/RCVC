<!-- VS code에서 markdown preview > contorl + shift +v

# RCVC

We have submitted the paper to ICASSP and will publish the code when the results come out in January 2022.

Thank you for your interest. -->


# RCVC - PyTorch official implementation

This is a Pytorch implementation of RCVC [RCVC: Rhythm Controllable Voice Conversion with Dynamic Information Bottleneck](https://github.com/intory89/RCVC). Feel free to use and modify the code and please refer our repo.

<br><br>
# Updates
+ 2022/01/24 Release the RCVC official code.

<br><br>
# Demo Samples
Audio samples generated by this implementation can be found [here](https://github.com/intory89/RCVC).

<br><br>
# Quick Start
## You can quickly run model using Google Collab
```
run inference.ipynb
```

<br><br>
## Install Dependencies
(Option) You can make an environment using anaconda
```
conda create -n py37torch17 python=3.7.9
```

(Option) And then activate your conda environment and install PyTorch and Tensorflow
```
conda activate py37torch17
conda install pytorch=1.7 torchvision torchaudio cudatoolkit=10.1 -c pytorch
pip install --upgrade tensorflow-gpu==1.15
```

You can install the python dependencies with
```
pip install -r requirements.txt
```
<br><br>
(Option) If you want to use the Korean dataset, install the 'mecab-ko' ,'mecab-ko-dic' and 'g2pk'.
+ Installation for mecab may vary depending on the version and installation environment, and we do not answer any questions regarding this. Below is the reference code related to the installation.
```
# download mecab-ko
cd /mecab
sudo wget https://bitbucket.org/eunjeon/mecab-ko/downloads/mecab-0.996-ko-0.9.2.tar.gz
sudo tar xvf mecab-0.996-ko-0.9.2.tar.gz

# install and setup
cd mecab-0.996-ko-0.9.2
sudo ./configure
sudo make
sudo make check
sudo make install
sudo ldconfig
```

```
# download mecab-ko-dic
wget https://bitbucket.org/eunjeon/mecab-ko-dic/downloads/mecab-ko-dic-2.0.1-20150920.tar.gz
tar xvf mecab-ko-dic-2.0.1-20150920.tar.gz

# install and setup
cd mecab-ko-dic-2.0.1-20150920
sudo ./autogen.sh
sudo ./configure
sudo ./configure --with-mecab-config=/opt/mecab-0.996-ko-0.9.2/mecab-config
sudo make
sudo make install

# test
mecab -d /usr/local/lib/mecab/dic/mecab-ko-dic 나는 황인선입니다.

# if you use conda environment, you should move config file
from: your_path\python-mecab-ko\mecab-0.996-ko-0.9.2\mecab-config
to: your_path\anaconda3\envs\py37torch17\bin\
```

```
# install g2pk
git clone https://github.com/Kyubyong/g2pK.git
python setup.py install
```

<br><br>
## Train Your Model
## Datasets
Preprocessing is supported for VCTK and NIKL Datasets. 
+ VCTK: CSTR VCTK Corpus: English Multi-speaker Corpus for CSTR Voice Cloning Toolkit (version 0.92)
https://datashare.ed.ac.uk/handle/10283/3443
+ NIKL

<br><br>
## Preprocessing
You can refer to the sample file and the file structure below on Github. For preprocessing, use the following command. <br>
For English dataset: VCTK


```
python preprocessing.py --in_dir data/VCTK/original/ --out_dir_name VCTK_22K --dataset VCTK
```


For Korean datast: NIKL
```
python preprocessing.py --in_dir data/NIKL/original/ --out_dir_name NIKL_22K --dataset NIKL
```


The file structure after preprocessing is as follows:
```
├── data
│   ├── VCTK
│   │   ├── original    
│   │   │   ├── wav48
│   │   │   │   ├── wavs
│   │   │   ├── metadata.csv
│   │   ├── VCTK22K   
│   │   │   ├── train
│   │   │   │   ├── p225
│   │   │   │   │   ├── p225_021.npz
│   │   │   │   │   ├── ...
│   │   │   │   │   ├── p225_423.npz
│   │   │   │   ├── ...
│   │   │   │   ├── p376
│   │   │   ├── val
│   │   │   ├── rhythm.txt
│   ├── NIKL
│   │   ├── original
│   │   │   ├── wavs
│   │   │   ├── metadata118.csv
│   │   ├── NIKL22K  
│   │   │   ├── train
│   │   │   ├── val
│   │   │   ├── rhythm.txt
```

<br><br>
## Train
To train, set hyperparameters in model/hparams.py and use the command.
```
python trainer.py --dataset VCTK --log_dir RCVC_test01
```


<br><br>
## Vocoder
We used Hifigan finetuned. The checkpoint can be downloaded [here](https://github.com/intory89/RCVC) and saved in 'vocoder/checkpoint'.


<br><br>
## Inference
```
python inference.py
```

<br><br>
# Checkpoint
We provide pretrained checkpoint. 

TODO


<br><br>
# Citation
TODO